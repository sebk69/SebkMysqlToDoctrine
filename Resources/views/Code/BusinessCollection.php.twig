<?php
{{ headComment }}
	
	namespace {{ businessNamespace }};
	
	use Doctrine\Common\Collections\ArrayCollection;
	use Doctrine\ORM\EntityManager;
	
	class BusinessCollection extends ArrayCollection
	{
		private $className;
		protected $entityManager;
		protected $factory;
		
		/**
		 * constructor
		 * @parm EntityManager $entityManager
		 * @parm BusinessFactory $factory
		 * @parm Array $array
		 */
		public function __construct(EntityManager $entityManager, BusinessFactory $factory, Array $array = array())
		{
			$this->entityManager = $entityManager;
            $this->factory = $factory;
			parent :: __construct($array);
		}
		
		/**
		 * set class of the collection
		 * @parm string $className
		 */
		protected function setClass($className)
		{
			$this->className = $className;
		}
		
		/**
		 * build from entities
		 * @parm EntityManager $entityManager
		 * @parm Array $array
		 */
		public function addAndBuildFromEntities($entities)
		{
			foreach($entities as $entity)
				$this->addAndBuildFromEntity($entity, $this->entityManager);
		}
		
		/**
		 * add an entity
		 * @parm unknown $entity
		 */
		public function addAndBuildFromEntity($entity)
		{
			$businessObject = $this->factory->get($this->className);
			$businessObject->setEntity($entity);
			$this[] = $businessObject;
		}
		
		public function getEntities()
		{
			$result = new ArrayCollection();
			foreach($this as $bo)
				$result[] = $bo->getEntity();
			return $result;
		}
		
		/**
		 * Create all entities into collection
		 */
		public function addAll()
		{
			$entities = $this->entityManager->getRepository("{{ bundle }}:".$this->className)->findAll();
			$this->addAndBuildFromEntities($entities);
		}
	}
?>